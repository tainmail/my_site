<!DOCTYPE html>
<html lang="zh-TW">

<head>
	<meta name="viewport" content="width=960">
	<meta charset="UTF-8">
	<title>估價單</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet" type="text/css"/>
</head>

<body>
	<!--app應用 開始-->
	<div id="app" class="container mt-4">
		<!--選單 開始-->
		<div class="nav_1 mb-3 no-print">
			<button class="btn btn-primary me-2" @click="bShowProjectModal = true">編輯報價單資料</button>
			<button class="btn btn-primary me-2" @click="fnJsonOpen">載入 JSON</button>
			<button class="btn btn-primary me-2" @click="fnJsonSave">儲存 JSON</button>
			<button class="btn btn-primary" onclick="window.print()">列印頁面</button>
		</div>
		<!--選單 結束-->
		<h1>
			<img :src="contractData.partyB.logo" style="height:50px; width:auto; vertical-align:middle;" class="me-2">
			{{ contractData.partyB.name }} 估價單
		</h1>
		<p class="mb-1"><strong>報價有效日期：</strong>{{ contractData.partyA.signatureDate }}</p>
		<p class="mb-2"><strong>注意事項：</strong>{{ contractData.partyB.note }}</p>


		<!--選單 開始-->
		<div class="nav_1 mb-3 no-print">
			<button class="btn btn-success me-2" @click="fnAddJob">新增工作明細</button>
		</div>
		<!--選單 結束-->

		<!--項目表格 開始-->
		<table class="table_1 table table-bordered border-secondary">
			<thead class="table-secondary border-secondary table-dark text-white">
				<tr>
					<th style="width:40px;"></th>
					<th>項目名稱</th>
					<th style="width:90px;">規格</th>
					<th style="width:50px;">數量</th>
					<th style="width:90px;">單價</th>
					<th style="width:90px;">複價</th>
					<th style="width:150px;">備註</th>
					<th class="no-print" style="width:120px;">操作</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="(item, idx) in contractData.jobList" :key="item.id">
					<td>{{ idx + 1 }}</td>
					<td>
						<h5>{{ item.name }}</h5>
						<ul>
							<li v-for="(item2, idx2) in item.taskList" :key="idx2">{{ item2 }}</li>
						</ul>
					</td>
					<td>{{ item.spec }}</td>
					<td class="text-end">{{ item.quantity }}</td>
					<td class="text-end">{{ item.unitPrice.toLocaleString() }}</td>
					<td class="text-end">{{ (item.quantity * item.unitPrice).toLocaleString() }}</td>
					<td>{{ item.note }}</td>
					<td class="no-print">
						<button class="btn btn-sm btn-warning me-1" @click="fnEditJob(item)">編輯</button>
						<button class="btn btn-sm btn-danger" @click="fnDelJob(idx)">刪除</button>
					</td>
				</tr>
			</tbody>
			<tfoot class="table-secondary border-secondary">
				<tr>
					<th colspan="5"></th>
					<th colspan="2"><h4>小計：{{ subtotal.toLocaleString() }} 元</h4></th>
					<th colspan="1" class="no-print"></th>
				</tr>
			</tfoot>
		</table>
		<!--項目表格 結束-->

		<!--雙方資料 開始-->
		<div class="d-flex flex-row gap-3 mb-4 align-items-stretch">
			<!-- 甲方 -->
			<div class="w-50" style="min-width: 0;">
			  <div class="partA p-3 rounded border border-secondary h-100 d-flex flex-column justify-content-between">
				<ul class="mb-2">
				  <li><strong>客戶名稱：</strong>{{ contractData.partyA.name }}</li>
				  <li><strong>電話：</strong>{{ contractData.partyA.phone }}</li>
				  <li><strong>Email：</strong>{{ contractData.partyA.email }}</li>
				  <li><strong>統編：</strong>{{ contractData.partyA.taxId }}</li>
				  <li><strong>地址：</strong>{{ contractData.partyA.address }}</li>
				</ul>
				<div class="rounded bg-white border border-secondary p-2 mt-auto" style="height:80px;">
				  簽章區
				</div>
			  </div>
			</div>
		  
			<!-- 乙方 -->
			<div class="w-50" style="min-width: 0;">
			  <div class="partB p-3 rounded border border-secondary h-100 d-flex flex-column justify-content-between">
				<ul class="mb-2">
				  <li><strong>{{ contractData.partyB.name }}：</strong>{{ contractData.partyB.representative }}</li>
				  <li><strong>電話：</strong>{{ contractData.partyB.phone }}</li>
				  <li><strong>Email：</strong>{{ contractData.partyB.email }}</li>
				  <li><strong>統編：</strong>{{ contractData.partyB.taxId }}</li>
				  <li><strong>網址：</strong>{{ contractData.partyB.website }}</li>
				  <li><strong>地址：</strong>{{ contractData.partyB.address }}</li>
				</ul>
				<div class="rounded bg-white border border-secondary p-2 mt-auto" style="height:80px;">
				  簽章區
				</div>
			  </div>
			</div>
		  </div>
		<!--雙方資料 結束-->

		<!--modal 編輯專案 開始-->
		<div class="modal fade" tabindex="-1"
			:class="{ show: bShowProjectModal === true, 'd-block': bShowProjectModal === true }"
			style="background-color: rgba(0,0,0,0.5); height: 100vh;" @click.self="bShowProjectModal = false">
			<div class="modal-dialog modal-lg" style="height: 95vh;">
				<div class="modal-content" style="height: 100%; display: flex; flex-direction: column;">
					<div class="modal-header justify-content-between align-items-start">
						<button class="btn btn-primary me-auto" @click="bShowProjectModal = false">確認修改</button>
						<button type="button" class="btn-close" @click="bShowProjectModal = false"></button>
					</div>
					<div class="modal-body" style="overflow-y: auto; flex: 1;">
						<h4 class="text-success">甲方資料</h4>

						<p class="mb-1">
							<strong>客戶名稱：</strong><input v-model="contractData.partyA.name" class="form-control">
						</p>

						<p class="mb-1">
							<strong>電話：</strong><input v-model="contractData.partyA.phone" class="form-control">
						</p>
						<p class="mb-1">
							<strong>Email：</strong><input v-model="contractData.partyA.email" class="form-control">
						</p>
						<p class="mb-1">
							<strong>統編：</strong><input v-model="contractData.partyA.taxId" class="form-control">
						</p>
						<p class="mb-1">
							<strong>地址：</strong><input v-model="contractData.partyA.address" class="form-control">
						</p>
						<p class="mb-1">
							<strong>報價有效日期：</strong><input v-model="contractData.partyA.signatureDate" class="form-control">
						</p>
						
						<hr>
						<h4 class="text-success">乙方資料</h4>
						<p class="mb-1">
							<strong>公司名稱：</strong><input v-model="contractData.partyB.name" class="form-control">
						</p>
						<p class="mb-1">
							<strong>負責人：</strong><input v-model="contractData.partyB.representative" class="form-control">
						</p>
						<p class="mb-1">
							<strong>電話：</strong><input v-model="contractData.partyB.phone" class="form-control">
						</p>
						<p class="mb-1">
							<strong>Email：</strong><input v-model="contractData.partyB.email" class="form-control">
						</p>
						<p class="mb-1">
							<strong>編號：</strong><input v-model="contractData.partyB.taxId" class="form-control">
						</p>
						<p class="mb-1">
							<strong>網址：</strong><input v-model="contractData.partyB.website" class="form-control">
						</p>
						<p class="mb-1">
							<strong>地址：</strong><input v-model="contractData.partyB.address" class="form-control">
						</p>
						<p class="mb-1">
							<strong>LOGO網址：</strong><input v-model="contractData.partyB.logo" class="form-control">
						</p>
						<p class="mb-1">
							<strong>注意事項：</strong><input v-model="contractData.partyB.note" class="form-control">
						</p>
					</div>
				</div>
			</div>
		</div>
		<!--modal 編輯專案 結束-->

		<!-- modal 編輯項目與工程明細 開始 -->
		<div class="modal fade" tabindex="-1" :class="{ show: bShowJobModal === true, 'd-block': bShowJobModal === true }"
			style="background-color: rgba(0,0,0,0.5); height: 100vh;" @click.self="bShowJobModal = false">
			<div class="modal-dialog modal-lg" style="height: 95vh;">
				<div class="modal-content" style="height: 100%; display: flex; flex-direction: column;">
					<div class="modal-header justify-content-between align-items-start">
						<button class="btn btn-primary me-auto" @click="bShowJobModal = false">確認修改</button>
						<button type="button" class="btn-close" @click="bShowJobModal = false"></button>
					</div>
					<div class="modal-body" style="overflow-y: auto; flex: 1;" v-if="currentEditJob">
						<h4 class="text-success">編輯工程明細</h4>
						<p class="mb-1">
							<strong>項目名稱：</strong>
							<input v-model="currentEditJob.name" class="form-control">
						</p>
						<p class="mb-1">
							<strong>規格：</strong>
							<input v-model="currentEditJob.spec" class="form-control">
						</p>
						<p class="mb-1">
							<strong>數量：</strong>
							<input v-model.number="currentEditJob.quantity" type="number" class="form-control">
						</p>
						<p class="mb-1">
							<strong>單價：</strong>
							<input v-model.number="currentEditJob.unitPrice" type="number" class="form-control">
						</p>
						<p class="mb-1">
							<strong>備註：</strong>
							<input v-model="currentEditJob.note" class="form-control">
						</p>
		
						<hr>
						<h4 class="text-success">工作任務</h4>
						<p class="mb-1">
							<input v-model="blankTask" class="form-control" placeholder="輸入工作任務">
							<button class="btn btn-success mt-2 mb-2" @click="fnAddTask">新增</button>
						</p>
		
						<ul class="mt-2">
							<li v-for="(item, idx) in currentEditJob.taskList" :key="idx">
								{{ item }}
								<button class="btn btn-sm btn-danger ms-2"
									@click="currentEditJob.taskList.splice(idx, 1)">刪除</button>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- modal 編輯項目與工程明細 結束 -->
	</div>
	<!--app應用 結束-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script type="module" src="js/app.js"></script>
</body>
</html>